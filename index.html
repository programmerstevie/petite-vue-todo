<!DOCTYPE html>
<html lang="en" data-theme="dark">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link href="https://cdn.jsdelivr.net/npm/daisyui@4.12.12/dist/full.min.css" rel="stylesheet" type="text/css" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/theme-change@2.0.2/index.js"></script>

  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400..700&display=swap" rel="stylesheet">

  <title>Steven's TODO App</title>

  <style>
    * {
      box-sizing: border-box;
    }

    .caveat-1 {
      font-family: "Caveat", cursive;
      font-optical-sizing: auto;
      font-weight: 500;
      font-style: normal;
    }

    @keyframes grow {
      0% {
        transform: scale(1.3) rotate(-12deg);
      }

      100% {
        transform: scale(1) rotate(-12deg);
      }
    }
  </style>
</head>

<body>
  <script type="module">
    import {
      createApp,
      reactive
    } from 'https://unpkg.com/petite-vue?module'

    const todoList = reactive({
      list: [{
        text: 'Buy carrots.',
        done: false,
        id: 0,
      }, {
        text: 'Prepare the chicken wings. Chop them into drums and flats.',
        done: true,
        id: 1,
      }],
      getNextId() {
        let i = 0;
        while (this.list.some(item => item.id === i)) i++
        return i;
      },
      addTodo(text) {
        if (text === "") return
        this.list.unshift({
          text: text,
          done: false,
          id: this.getNextId()
        })
      },
      moveTodoToEnd(id) {
        let ix = this.getTodoIxById(id);
        let t = this.list[ix];
        this.list.splice(ix, 1);
        this.list.push(t);
      },
      getTodoIxById(id) {
        let ix = this.list.findIndex(item => item.id === id);
        if (ix === -1) {
          throw new Error('Something went wrong finding the item' + id)
        }
        return ix
      },
      deleteTodo(id) {
        let ix = this.list.findIndex(item => item.id === id);
        if (ix === -1) {
          console.error('something went wrong deleting the item' + id)
          return;
        }
        this.list.splice(ix, 1);
      }
    })

    function TaskComponent(props) {
      return {
        $template: "#task-template",
        get todo() {
          return {
            get text() {
              return props.todo.text
            },
            get done() {
              return props.todo.done
            },
            get id() {
              return props.todo.id
            },
            set done(newval) {
              const this_ix = todoList.getTodoIxById(props.todo.id)
              todoList.list[this_ix].done = newval
              if (newval) {
                todoList.moveTodoToEnd(props.todo.id)
              }
            }
          }
        },
      }
    }

    /**
     * @function
     * @param {SubmitEvent} e
     */
    function onSubmit(e) {
      // e.target is the form. "todoText" is the 'name' attribute of the input element
      const val = e.target["todoText"].value
      e.target["todoText"].value = ''

      todoList.addTodo(val)
    }

    createApp({
      todoList,
      onSubmit,
      TaskComponent
    }).mount()
  </script>

  <header class="">
    <nav class="navbar shadow-lg bg-base-100 flex justify-center">
      <div class="w-[75vw] sm:w-[400px] md:w-[600px] lg:w-[950px]">
        <label class="swap swap-rotate">
          <input type="checkbox" value="bumblebee" class="theme-controller" />
          <span class="material-icons swap-on">
            light_mode
          </span>
          <span class="material-icons swap-off">
            dark_mode
          </span>
        </label>
      </div>
    </nav>
    <div class="flex justify-center mt-20">
      <div class="relative">
        <h1 class="font-bold text-4xl">
          Steven's TODO App!
        </h1>
        <aside class="absolute sm:right-[-150px] sm:top-[50px] text-lg caveat-1 sm:transition-transform sm:animate-[grow_2s_ease-in-out_alternate_infinite]">
          Built with Petite-Vue!
        </aside>
      </div>
    </div>
  </header>

  <main>
    <div class="flex justify-center mt-12">
      <div v-scope class="inline-block flex flex-col items-center">
        <form @submit.prevent="onSubmit" class="join">
          <input type="text" name="todoText" class="input input-bordered join-item">

          <button type="submit" class="btn btn-accent join-item">
            Add Task
          </button>
        </form>
        <ul class="mt-32">
          <li v-for="(item, index) in todoList.list" :key="item.id" v-scope="TaskComponent({todo: item})" class="mt-5 first:mt-0">
        </ul>
      </div>
    </div>
  </main>

  <template id="task-template">
    <div class="rounded flex min-h-28 overflow-visible join">
      <button @click="todo.done = !todo.done" class="btn flex items-center py-5 justify-center join-item
            w-[75vw] sm:w-[400px] md:w-[600px] lg:w-[900px]
            h-auto" :class="{
              'line-through text-success bg-transparent border-solid border-neutral border-l border-t border-b hover:bg-base-200': todo.done,
              'border-none': !todo.done 
            }">
        <p class="uppercase text-wrap break-words w-full leading-8">
          {{ todo.text }}
        </p>
      </button>
      <button @click="todoList.deleteTodo(todo.id)" class="btn btn-error h-auto w-[50px] join-item" :class="{
              'btn-disabled': !todo.done
            }">
        <span class="material-icons" :class="{
          'text-error-content': todo.done
        }">
          delete
        </span>
      </button>
    </div>
  </template>
</body>

</html>